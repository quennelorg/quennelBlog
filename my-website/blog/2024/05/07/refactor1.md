---
slug: refactor1
title: 重构1
authors: quennel
tags: [refactor]
date: 2024-05-07T10:19
---

## 重构是对已有代码所做的改动，并且这个改动是为了将来更好的改动

- 如果代码能够正常工作，并且不会被再次修改，而且不妨碍人去理解它，那么完全没必要去重构
- 重构随时可以停下来，如果因为重构耽误了需求开发，那么这个行为超出了重构

### 两顶帽子
Kent Beck 提出了“两顶帽子”的比喻

使用重构技术开发软件时，我把自己的时间 分配给两种截然不同的行为:添加新功能和重构。
- 添加新功能时，我不应该修改既 有代码，只管添加新功能。通过添加测试并让测试正常运行，我可以衡量自己的工作进度。
- 重构时我就不能再添加功能，只管调整代码的结构。此时我不应该添加任何测试，除非发现有先前遗漏的东西，只在绝对必要比如用以处理接口变化时才修改测试。

在实际开发中，这两顶帽子可能会时刻变化，比如先加功能，再重构代码，再加功能。当然无论是在加功能或者重构的时候都要明确这次行为是要做什么

### 何时重构
#### 三次法则
Don Roberts 给了我一条准则:
- 第一次做某件事时只管去做;
- 第二次做类似的事会产生反感，但无论如何还是可以去做;
- 第三次再做类似的事，你就应该重构。

#### 见机行事的重构
- 预备性重构：当我想加一个新功能的时候，发现只要复制之前的function，然后改几个值就可以，这时候就可以把这个function进行重构，使函数参数化，根据需要提供不同的参数
- 帮助理解的重构：很多时候，添加一个新功能需要理解旧代码的含义，这时候可以对旧代码进行简单的重构，帮助理解，比如改变方法名称，写好注释，提取函数等
- 捡垃圾重构： 我明白旧代码含义，但是因为新需求时间原因，没有时间去重构，这时候可以记下来，完成新需求，就去重构这些旧代码

#### 如果重写比重构还简单，则直接重写


## 第一步 测试
如果要对已有代码进行重构，第一步要做的就是写好测试，只有在保证已有功能不会被破坏的前提下，才能够进行重构
程序越大，修改就极易破坏原有功能

## 重构手法
- 命名很重要，需要做到通过命名就能理解代码的含义
- 小步提交
- 将复杂的代码块分解成更小的模块
### function 提取
将一个方法或者类的某块代码提取出来，以便复用和单一职责
### variable 提取
将临时变量或者某一些变量当作一个function的结果来提取，或者删除多余的变量
### 多态
根据类别可以将多个类似的逻辑封装成一个父类，然后子类分别继承，分别实现独立的逻辑，实现父类方法多态调用，也就是用多态来取代条件表达式

## 不需要把代码变得完美
很多时候 重构和新需求之间是需要平衡，在新需求面前，重构必须被延缓，只要保证在离开重构的时候，代码库比重构之前更健康